/**
* vue-app-scroller v1.0.4
* https://github.com/JooZh/vue-app-scroller
* Released under the MIT License.
*/
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.VueAppScroller=i()}(this,function(){"use strict";var i,Y,y,e,S,n=(i=window,Y=Date.now||function(){return+new Date},y={},e=1,S={requestAnimationFrame:function(){var e=i.requestAnimationFrame||i.webkitRequestAnimationFrame||i.mozRequestAnimationFrame||i.oRequestAnimationFrame,t=!!e;if(e&&!/requestAnimationFrame\(\)\s*\{\s*\[native code\]\s*\}/i.test(e.toString())&&(t=!1),t)return function(t,i){e(t,i)};var s={},n=1,o=null,l=+new Date;return function(t,i){var e=n++;return s[e]=t,0,null===o&&(o=setInterval(function(){var t=+new Date,i=s;for(var e in s={},0,i)i.hasOwnProperty(e)&&(i[e](t),l=t);2500<t-l&&(clearInterval(o),o=null)},1e3/60)),e}}(),stop:function(t){var i=null!=y[t];return i&&(y[t]=null),i},isRunning:function(t){return null!=y[t]},start:function(h,r,a,c,u,p){var g=Y(),m=g,f=0,d=0,v=e++;if(p||(p=document.body),v%20==0){var t={};for(var i in y)t[i]=!0;y=t}return y[v]=!0,S.requestAnimationFrame(function t(i){var e=!0!==i,s=Y();if(!y[v]||r&&!r(v))return y[v]=null,void(a&&a(60-d/((s-g)/1e3),v,!1));if(e)for(var n=Math.round((s-m)/(1e3/60))-1,o=0;o<Math.min(n,4);o++)t(!0),d++;c&&1<(f=(s-g)/c)&&(f=1);var l=u?u(f):f;!1!==h(l,s,e)&&1!==f||!e?e&&(m=s,S.requestAnimationFrame(t,p)):(y[v]=null,a&&a(60-d/((s-g)/1e3),v,1===f||null==c))},p),v}}),t=function(){function s(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(t,i,e){return i&&s(t.prototype,i),e&&s(t,e),t}}();return function(){function s(t,i){for(var e in function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,s),this.NOOP=function(){console.log("s")},this.handles={scroll:[],loading:[]},this.options={listenScroll:!1,isPullRefresh:!1,isReachBottom:!1,scrollingX:!1,scrollingY:!1,animating:!0,animationDuration:250,mousewheel:!1,paging:!1,snapping:!1,snappingType:"defalut",snappingSelect:0,snappingListIndex:0,bouncing:!0,speedMultiplier:1.5,scrollingComplete:this.NOOP,snappingComplete:this.NOOP,penetrationDeceleration:.03,penetrationAcceleration:.08},i)this.options[e]=i[e];this._initScrollAttr(t),this._setSnapSize(this.options.snapping),this._initEventListener(this.container)}return t(s,[{key:"_initEventListener",value:function(t){var i=this;this.enableScrollX=this.options.scrollingX,this.enableScrollY=this.options.scrollingY;var e=!1;t.addEventListener("touchstart",function(t){t.target.tagName.match(/input|textarea|select/i)||i.doTouchStart(t.touches,t.timeStamp)}),t.addEventListener("touchmove",function(t){t.preventDefault(),i.doTouchMove(t.touches,t.timeStamp)}),t.addEventListener("touchend",function(t){i.doTouchEnd(t.timeStamp)}),t.addEventListener("mousedown",function(t){t.target.tagName.match(/input|textarea|select/i)||(i.doTouchStart([{pageX:t.pageX,pageY:t.pageY}],t.timeStamp),e=!0)}),t.addEventListener("mousemove",function(t){e&&(i.doTouchMove([{pageX:t.pageX,pageY:t.pageY}],t.timeStamp),e=!0)}),t.addEventListener("mouseup",function(t){e&&(i.doTouchEnd(t.timeStamp),e=!1)}),this.options.mousewheel&&t.addEventListener("mousewheel",function(t){i.scrollY=i.scrollY+=t.deltaY,i.scrollY>i.maxHeightScrollY&&(i.scrollY=i.maxHeightScrollY),i.scrollY<0&&(i.scrollY=0),i._publish(i.scrollX,i.scrollY,!0)})}},{key:"_initScrollAttr",value:function(t){this.content=t,this.container=t.parentNode,this.render=function(e){var t=window,i=document.documentElement.style,s=void 0;t.opera&&"[object Opera]"===Object.prototype.toString.call(opera)?s="presto":"MozAppearance"in i?s="gecko":"WebkitAppearance"in i?s="webkit":"string"==typeof navigator.cpuClass&&(s="trident");var n={trident:"ms",gecko:"Moz",webkit:"Webkit",presto:"O"}[s],o=document.createElement("div"),l=n+"Perspective",h=n+"Transform";return void 0!==o.style[l]?function(t,i){e.style[h]="translate3d("+-t+"px,"+-i+"px,0)"}:void 0!==o.style[h]?function(t,i){e.style[h]="translate("+-t+"px,"+-i+"px)"}:function(t,i){e.style.marginLeft=t?-t+"px":"",e.style.marginTop=i?-i+"px":""}}(this.content),this.animate=n,this.scrollDirection="",this.isTracking=!1,this.completeDeceleration=!1,this.isDragging=!1,this.isDecelerating=!1,this.isAnimating=!1,this.enableScrollX=!1,this.enableScrollY=!1,this.refreshActive=!1,this.reachBottomActive=!1,this.snappingTypeInit=!1,this.interruptedAnimation=!0,this.refreshStartCallBack=null,this.refreshDeactivateCallBack=null,this.refreshActivateCallBack=null,this.scrollX=0,this.scrollY=0,this.minWidthScrollX=0,this.minHeightScrollY=0,this.maxWidthScrollX=0,this.maxHeightScrollY=0,this.prevScrollX=0,this.prevScrollY=0,this.scheduledX=0,this.scheduledY=0,this.lastTouchX=0,this.lastTouchY=0,this.decelerationVelocityX=0,this.decelerationVelocityY=0,this.refreshHeight=0,this.loadingHeight=0,this.contentWidth=0,this.contentHeight=0,this.containerWidth=0,this.containerHeight=0,this.snapWidth=50,this.snapHeight=50,this.minDecelerationScrollX=0,this.minDecelerationScrollY=0,this.maxDecelerationScrollX=0,this.maxDecelerationScrollY=0,this.lastTouchTime=null,this.positionsArray=null}},{key:"_setSnapSize",value:function(t){"number"==typeof t?(this.snapWidth=t,this.snapHeight=t):Array.isArray(t)&&(this.snapWidth=t[0],this.snapHeight=t[1])}},{key:"_setDimensions",value:function(){var t=this.container.offsetWidth,i=this.container.offsetHeight,e=this.content.offsetWidth,s=this.content.offsetHeight;t===+t&&(this.containerWidth=t),i===+i&&(this.containerHeight=i),e===+e&&(this.contentWidth=e),s===+s&&(this.contentHeight=s);var n=this.maxHeightScrollY,o=this.content.children,l=Math.max(this.contentHeight-this.containerHeight,0);if(this.refreshHeight=this.options.isPullRefresh?o[0].offsetHeight:0,this.loadingHeight=this.options.isReachBottom?o[o.length-1].offsetHeight:0,this.maxWidthScrollX=Math.max(this.contentWidth-this.containerWidth,0),this.maxHeightScrollY=l-this.refreshHeight,"select"===this.options.snappingType){var h=Math.round(this.containerHeight/this.snapHeight);if(this.minHeightScrollY=-this.snapHeight*Math.floor(h/2),this.maxHeightScrollY=this.minHeightScrollY+(o[1].children.length-1)*this.snapHeight,!this.snappingTypeInit){var r=this.minHeightScrollY+this.options.snappingSelect*this.snapHeight;this.scrollY=r,this.snappingTypeInit=!0}}this.options.isReachBottom&&(n!==this.maxHeightScrollY?this.reachBottomActive=!1:0!=this.maxHeightScrollY&&this.emit("loading",{hasMore:!1})),this._scrollTo(this.scrollX,this.scrollY,!0)}},{key:"_easeOutCubic",value:function(t){return Math.pow(t-1,3)+1}},{key:"_easeInOutCubic",value:function(t){return(t/=.5)<1?.5*Math.pow(t,3):.5*(Math.pow(t-2,3)+2)}},{key:"doTouchStart",value:function(t,i){this._isTouches(t),this._isTouchesTime(i),this.isTracking=!0,this.stopScroll(),this.lastTouchX=t[0].pageX,this.lastTouchY=t[0].pageY,this.lastTouchTime=i}},{key:"doTouchMove",value:function(t,i){if(this._isTouches(t),this._isTouchesTime(i),this.isTracking){var e=t[0].pageX,s=t[0].pageY;if(this._doTouchMoveDirection(e,s),this.isDragging){var n=e-this.lastTouchX,o=s-this.lastTouchY;this.enableScrollX&&this._doTouchMoveActive(n,"X"),this.enableScrollY&&this._doTouchMoveActive(o,"Y"),60<this.positionsArray.length&&this.positionsArray.splice(0,30),this.positionsArray.push(this.scrollX,this.scrollY,i),this._publish(this.scrollX,this.scrollY)}else{var l=Math.abs(e-this.lastTouchX),h=Math.abs(s-this.lastTouchY);this.isDragging=5<=l||5<=h,this.isDragging&&(this.interruptedAnimation=!1)}this.lastTouchX=e,this.lastTouchY=s,this.lastTouchTime=i}}},{key:"doTouchEnd",value:function(t){if(this._isTouchesTime(t),this.isTracking){if(this.isTracking=!1,this.isDragging)if(this.isDragging=!1,this.options.animating&&t-this.lastTouchTime<=100)this._doTouchEndHasDeceleration()?this.refreshActive||this._startDeceleration(t):this._scrollingComplete();else 100<t-this.lastTouchTime&&this._scrollingComplete();this.isDecelerating||(this.refreshActive&&this.refreshStartCallBack?(this._publish(this.scrollX,-this.refreshHeight,!0),this.refreshStartCallBack&&this.refreshStartCallBack()):((this.interruptedAnimation||this.isDragging)&&this._scrollingComplete(),0<this.scrollY||0<this.scrollX?this._scrollTo(this.scrollX,this.scrollY,!0):this._startDeceleration(),this.refreshActive&&(this.refreshActive=!1,this.refreshDeactivateCallBack&&this.refreshDeactivateCallBack()))),this.positionsArray.length=0}}},{key:"_isTouches",value:function(t){if(null==t.length)throw new Error("Invalid touch list: "+t)}},{key:"_isTouchesTime",value:function(t){if(t instanceof Date&&(t=t.valueOf()),"number"!=typeof t)throw new Error("Invalid timestamp value: "+t)}},{key:"_doTouchMoveActive",value:function(t,i){this["scroll"+i]-=t*this.options.speedMultiplier,(this["scroll"+i]>this["maxWidthScroll"+i]||this["scroll"+i]<0)&&(this.options.bouncing?(this["scroll"+i]+=t/2*this.options.speedMultiplier,"Y"===i&&this._doTouchMovePullRefresh()):this["scroll"+i]>this["maxWidthScroll"+i]?this["scroll"+i]=this["maxWidthScroll"+i]:this["scroll"+i]=0)}},{key:"_doTouchMovePullRefresh",value:function(){null!=this.refreshHeight&&(!this.refreshActive&&this.scrollY<=-this.refreshHeight?(this.refreshActive=!0,this.refreshActivateCallBack&&this.refreshActivateCallBack()):this.refreshActive&&this.scrollY>-this.refreshHeight&&(this.refreshActive=!1,this.refreshDeactivateCallBack&&this.refreshDeactivateCallBack()))}},{key:"_doTouchMoveDirection",value:function(t,i){var e=t-this.lastTouchX,s=i-this.lastTouchY;0<e&&Math.abs(e)>Math.abs(s)?this.scrollDirection="right":e<0&&Math.abs(e)>Math.abs(s)?this.scrollDirection="left":0<s&&Math.abs(s)>Math.abs(e)?this.scrollDirection="down":s<0&&Math.abs(s)>Math.abs(e)&&(this.scrollDirection="up")}},{key:"_doTouchEndHasDeceleration",value:function(){for(var t=!1,i=this.positionsArray.length-1,e=i,s=i;0<s&&this.positionsArray[s]>this.lastTouchTime-100;s-=3)e=s;if(e!==i){var n=this.positionsArray[i]-this.positionsArray[e],o=this.scrollX-this.positionsArray[e-2],l=this.scrollY-this.positionsArray[e-1];this.decelerationVelocityX=o/n*(1e3/60),this.decelerationVelocityY=l/n*(1e3/60);var h=this.options.paging||this.options.snapping?4:1,r=Math.abs(this.decelerationVelocityX)>h,a=Math.abs(this.decelerationVelocityY)>h;(r||a)&&(t=!0)}return t}},{key:"refresh",value:function(){this._setDimensions()}},{key:"publish",value:function(t,i,e){this._publish(t,i,e)}},{key:"scrollTo",value:function(t,i,e){this._scrollTo(t,i,e)}},{key:"scrollBy",value:function(t,i,e){this._scrollBy(t,i,e)}},{key:"getAttr",value:function(t){if(-1!==["scrollDirection","enableScrollX","enableScrollY","minWidthScrollX","minHeightScrollY","maxWidthScrollX","maxHeightScrollY"].indexOf(t))return this[t];throw new Error('can not get attr name "key" ')}},{key:"setAttr",value:function(t,i){if(-1===["enableScrollX","enableScrollY"].indexOf(t))throw new Error('can not set attr name "key" ');this[t]=i}},{key:"stopScroll",value:function(){this.isDecelerating&&(this.animate.stop(this.isDecelerating),this.isDecelerating=!1,this.interruptedAnimation=!0),this.isAnimating&&(this.animate.stop(this.isAnimating),this.isAnimating=!1,this.interruptedAnimation=!0),this.interruptedAnimation=!0,this.completeDeceleration=!1,this.positionsArray=[]}},{key:"activatePullToRefresh",value:function(t,i,e){this.refreshActivateCallBack=t,this.refreshDeactivateCallBack=i,this.refreshStartCallBack=e}},{key:"finishPullToRefresh",value:function(){this.refreshActive=!1,this.refreshDeactivateCallBack&&this.refreshDeactivateCallBack(),this._scrollTo(this.scrollX,this.scrollY,!0)}},{key:"on",value:function(t,i){if(this.handles.hasOwnProperty(t)||(this.handles[t]=[]),"function"!=typeof i)throw new Error("Missing callback function");this.handles[t].push(i)}},{key:"emit",value:function(t){for(var i=arguments.length,s=Array(1<i?i-1:0),e=1;e<i;e++)s[e-1]=arguments[e];if(!this.handles.hasOwnProperty(t))throw new Error('"'+t+'"Event not registered');this.handles[t].forEach(function(t,i,e){t.apply(null,s)})}},{key:"_scrollTo",value:function(t,i,e){this.isDecelerating&&(this.animate.stop(this.isDecelerating),this.isDecelerating=!1),this.options.scrollingX?this.options.paging?t=Math.round(t/this.containerWidth)*this.containerWidth:this.options.snapping&&(t=Math.round(t/this.snapWidth)*this.snapWidth):t=this.scrollX,this.options.scrollingY?this.options.paging?i=Math.round(i/this.containerHeight)*this.containerHeight:this.options.snapping&&(i=Math.round(i/this.snapHeight)*this.snapHeight):i=this.scrollY,"select"===this.options.snappingType?(t=Math.max(Math.min(this.maxWidthScrollX,t),this.minWidthScrollX),i=Math.max(Math.min(this.maxHeightScrollY,i),this.minHeightScrollY)):"default"===this.options.snappingType&&(t=Math.max(Math.min(this.maxWidthScrollX,t),0),i=Math.max(Math.min(this.maxHeightScrollY,i),0)),t===this.scrollX&&i===this.scrollY&&(e=!1),this.isTracking||this._publish(t,i,e)}},{key:"_scrollToElement",value:function(){}},{key:"_scrollBy",value:function(t,i,e){var s=this.isAnimating?this.scheduledX:this.scrollX,n=this.isAnimating?this.scheduledY:this.scrollY;this._scrollTo(s+(t||0),n+(i||0),e)}},{key:"_publish",value:function(t,i,e){var s=this,n=this.isAnimating;if(n&&(this.animate.stop(n),this.isAnimating=!1,this.interruptedAnimation=!0),e&&this.options.animating){this.scheduledX=t,this.scheduledY=i;var o=this.scrollX,l=this.scrollY,h=t-o,r=i-l,a=n?this._easeOutCubic:this._easeInOutCubic;this.isAnimating=this.animate.start(function(t,i,e){e&&(s.scrollX=o+h*t,s.scrollY=l+r*t,s.render&&s.render(s.scrollX,s.scrollY))},function(t){return s.isAnimating===t},function(t,i,e){i===s.isAnimating&&(s.isAnimating=!1),(s.completeDeceleration||e)&&(s._scrollingComplete(),s._snappingComplete())},this.options.animationDuration,a)}else this.scheduledX=this.scrollX=t,this.scheduledY=this.scrollY=i,this.render&&this.render(t,i);if(this.options.isReachBottom&&!this.reachBottomActive){var c=Number(this.scrollY.toFixed()),u=this.maxHeightScrollY-this.loadingHeight;u<c&&0<u&&(this.emit("loading",{hasMore:!0}),this.reachBottomActive=!0)}if(this.options.listenScroll){var p=this.prevScrollX.toFixed()!==this.scrollX.toFixed(),g=this.prevScrollY.toFixed()!==this.scrollY.toFixed();(p||g)&&this.emit("scroll",{x:Math.floor(this.scrollX),y:Math.floor(this.scrollY)})}}},{key:"_scrollingComplete",value:function(){this.options.scrollingComplete()}},{key:"_snappingComplete",value:function(){if("select"===this.options.snappingType){var t=this._getSelectValue();this.options.snappingComplete(t)}}},{key:"_getSelectValue",value:function(){var t=Math.abs(this.minHeightScrollY),i=(this.scrollY<0?t-Math.abs(this.scrollY):t+Math.abs(this.scrollY))/this.snapHeight;return{listIndex:this.options.snappingListIndex,selectIndex:Math.floor(i)}}},{key:"_startDeceleration",value:function(){var s=this;if(this.options.paging){var t=Math.max(Math.min(this.scrollX,this.maxWidthScrollX),0),i=Math.max(Math.min(this.scrollY,this.maxHeightScrollY),0);this.minDecelerationScrollX=Math.floor(t/this.containerWidth)*this.containerWidth,this.minDecelerationScrollY=Math.floor(i/this.containerHeight)*this.containerHeight,this.maxDecelerationScrollX=Math.ceil(t/this.containerWidth)*this.containerWidth,this.maxDecelerationScrollY=Math.ceil(i/this.containerHeight)*this.containerHeight}else this.minDecelerationScrollX=0,this.minDecelerationScrollY=0,this.maxDecelerationScrollX=this.maxWidthScrollX,this.maxDecelerationScrollY=this.maxHeightScrollY;var e=this.options.snapping?3:.02;this.isDecelerating=this.animate.start(function(t,i,e){s._stepThroughDeceleration(e)},function(){var t=Math.abs(s.decelerationVelocityX)>=e||Math.abs(s.decelerationVelocityY)>=e;return t||(s.completeDeceleration=!0),t},function(t,i,e){s.isDecelerating=!1,s.completeDeceleration&&s._scrollingComplete(),s._scrollTo(s.scrollX,s.scrollY,s.options.snapping)})}},{key:"_stepThroughDeceleration",value:function(t){var i=this.scrollX+this.decelerationVelocityX,e=this.scrollY+this.decelerationVelocityY;if(!this.options.bouncing){var s=Math.max(Math.min(this.maxDecelerationScrollX,i),this.minDecelerationScrollX);s!==i&&(i=s,this.decelerationVelocityX=0);var n=Math.max(Math.min(this.maxDecelerationScrollY,e),this.minDecelerationScrollY);n!==e&&(e=n,this.decelerationVelocityY=0)}if(this.prevScrollX=this.scrollX,this.prevScrollY=this.scrollY,t?this._publish(i,e):(this.scrollX=i,this.scrollY=e),!this.options.paging){this.decelerationVelocityX*=.95,this.decelerationVelocityY*=.95}if(this.options.bouncing){var o=0,l=0,h=this.options.penetrationDeceleration,r=this.options.penetrationAcceleration;i<this.minDecelerationScrollX?o=this.minDecelerationScrollX-i:i>this.maxDecelerationScrollX&&(o=this.maxDecelerationScrollX-i),e<this.minDecelerationScrollY?l=this.minDecelerationScrollY-e:e>this.maxDecelerationScrollY&&(l=this.maxDecelerationScrollY-e),0!==o&&(o*this.decelerationVelocityX<=0?this.decelerationVelocityX+=o*h:this.decelerationVelocityX=o*r),0!==l&&(l*this.decelerationVelocityY<=0?this.decelerationVelocityY+=l*h:this.decelerationVelocityY=l*r)}}}]),s}()});