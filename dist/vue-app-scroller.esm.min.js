/**
* vue-app-effect v1.0.0
* https://github.com/JooZh/vue-app-scroller
* Released under the MIT License.
*/
var Animate=function(t){var i=Date.now||function(){return+new Date},e={},s=1,o={requestAnimationFrame:function(){var i=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame,e=!!i;if(i&&!/requestAnimationFrame\(\)\s*\{\s*\[native code\]\s*\}/i.test(i.toString())&&(e=!1),e)return function(t,e){i(t,e)};var s={},o=1,l=null,n=+new Date;return function(t,i){var e=o++;return s[e]=t,0,null===l&&(l=setInterval(function(){var t=+new Date,i=s;for(var e in s={},0,i)i.hasOwnProperty(e)&&(i[e](t),n=t);t-n>2500&&(clearInterval(l),l=null)},1e3/60)),e}}(),stop:function(t){var i=null!=e[t];return i&&(e[t]=null),i},isRunning:function(t){return null!=e[t]},start:function(t,l,n,r,h,a){var c=i(),u=c,p=0,m=0,g=s++;if(a||(a=document.body),g%20==0){var f={};for(var d in e)f[d]=!0;e=f}return e[g]=!0,o.requestAnimationFrame(function s(f){var d=!0!==f,v=i();if(!e[g]||l&&!l(g))return e[g]=null,void(n&&n(60-m/((v-c)/1e3),g,!1));if(d)for(var Y=Math.round((v-u)/(1e3/60))-1,X=0;X<Math.min(Y,4);X++)s(!0),m++;r&&(p=(v-c)/r)>1&&(p=1);var S=h?h(p):p;!1!==t(S,v,d)&&1!==p||!d?d&&(u=v,o.requestAnimationFrame(s,a)):(e[g]=null,n&&n(60-m/((v-c)/1e3),g,1===p||null==r))},a),g}};return o}(window),Render=function(t){var i,e=window,s=document.documentElement.style;e.opera&&"[object Opera]"===Object.prototype.toString.call(opera)?i="presto":"MozAppearance"in s?i="gecko":"WebkitAppearance"in s?i="webkit":"string"==typeof navigator.cpuClass&&(i="trident");var o={trident:"ms",gecko:"Moz",webkit:"Webkit",presto:"O"}[i],l=document.createElement("div"),n=o+"Perspective",r=o+"Transform";return void 0!==l.style[n]?function(i,e){t.style[r]="translate3d("+-i+"px,"+-e+"px,0)"}:void 0!==l.style[r]?function(i,e){t.style[r]="translate("+-i+"px,"+-e+"px)"}:function(i,e){t.style.marginLeft=i?-i+"px":"",t.style.marginTop=e?-e+"px":""}},_createClass=function(){function t(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}();function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var Scroller=function(){function t(i,e){for(var s in _classCallCheck(this,t),this.NOOP=function(){},this.options={listenScroll:!1,isPullRefresh:!1,isReachBottom:!1,scrollingX:!1,scrollingY:!1,animating:!0,animationDuration:250,mousewheel:!1,paging:!1,snapping:!1,bouncing:!0,speedMultiplier:1.5,scrollingComplete:this.NOOP,penetrationDeceleration:.03,penetrationAcceleration:.08},e)this.options[s]=e[s];this.container=i.parentNode,this.content=i,this.render=Render(this.content),this.animate=Animate,this.handles={scroll:[]},this.isSingleTouch=!1,this.isTracking=!1,this.completeDeceleration=!1,this.isDragging=!1,this.isDecelerating=!1,this.isAnimating=!1,this.enableScrollX=!1,this.enableScrollY=!1,this.refreshActive=!1,this.reachBottomActive=!1,this.refreshStartCallBack=null,this.refreshDeactivateCallBack=null,this.refreshActivateCallBack=null,this.scrollX=0,this.scrollY=0,this.prevScrollX=0,this.prevScrollY=0,this.scheduledX=0,this.scheduledY=0,this.lastTouchX=0,this.lastTouchY=0,this.decelerationVelocityX=0,this.decelerationVelocityY=0,this.maxScrollX=0,this.maxScrollY=0,this.refreshHeight=0,this.loadingHeight=0,this.contentHeight=0,this.contentWidth=0,this.containerHeight=0,this.containerWidth=0,this.snapWidth=50,this.snapHeight=50,this.minDecelerationScrollX=0,this.minDecelerationScrollY=0,this.maxDecelerationScrollX=0,this.maxDecelerationScrollY=0,this.lastTouchMoveTime=null,this.positionsArray=null,this.initEventListener(this.container)}return _createClass(t,[{key:"easeOutCubic",value:function(t){return Math.pow(t-1,3)+1}},{key:"easeInOutCubic",value:function(t){return(t/=.5)<1?.5*Math.pow(t,3):.5*(Math.pow(t-2,3)+2)}},{key:"initEventListener",value:function(t){var i=this,e=!1;t.addEventListener("touchstart",function(t){t.target.tagName.match(/input|textarea|select/i)||i.doTouchStart(t.touches,t.timeStamp)}),t.addEventListener("touchmove",function(t){t.preventDefault(),i.doTouchMove(t.touches,t.timeStamp)}),t.addEventListener("touchend",function(t){i.doTouchEnd(t.timeStamp)}),t.addEventListener("mousedown",function(t){t.target.tagName.match(/input|textarea|select/i)||(i.doTouchStart([{pageX:t.pageX,pageY:t.pageY}],t.timeStamp),e=!0)}),t.addEventListener("mousemove",function(t){e&&(i.doTouchMove([{pageX:t.pageX,pageY:t.pageY}],t.timeStamp),e=!0)}),t.addEventListener("mouseup",function(t){e&&(i.doTouchEnd(t.timeStamp),e=!1)}),this.options.mousewheel&&t.addEventListener("mousewheel",function(t){i.scrollY=i.scrollY+=t.deltaY,i.scrollY>i.maxScrollY&&(i.scrollY=i.maxScrollY),i.scrollY<0&&(i.scrollY=0),i._publish(i.scrollX,i.scrollY,!0)})}},{key:"doTouchStart",value:function(t,i){if(null==t.length)throw new Error("Invalid touch list: "+t);if(i instanceof Date&&(i=i.valueOf()),"number"!=typeof i)throw new Error("Invalid timestamp value: "+i);this._interruptedAnimation=!0,this.isDecelerating&&(this.animate.stop(this.isDecelerating),this.isDecelerating=!1,this._interruptedAnimation=!0),this.isAnimating&&(this.animate.stop(this.isAnimating),this.isAnimating=!1,this._interruptedAnimation=!0);var e=0,s=0,o=1===t.length;o?(e=t[0].pageX,s=t[0].pageY):(e=Math.abs(t[0].pageX+t[1].pageX)/2,s=Math.abs(t[0].pageY+t[1].pageY)/2),this.lastTouchX=e,this.lastTouchY=s,this.lastTouchMoveTime=i,this.enableScrollX=!o&&this.options.scrollingX,this.enableScrollY=!o&&this.options.scrollingY,this.isTracking=!0,this.completeDeceleration=!1,this.isDragging=!o,this.isSingleTouch=o,this.positionsArray=[]}},{key:"doTouchMove",value:function(t,i){if(null==t.length)throw new Error("Invalid touch list: "+t);if(i instanceof Date&&(i=i.valueOf()),"number"!=typeof i)throw new Error("Invalid timestamp value: "+i);if(this.isTracking){var e=0,s=0;if(2===t.length?(e=Math.abs(t[0].pageX+t[1].pageX)/2,s=Math.abs(t[0].pageY+t[1].pageY)/2):(e=t[0].pageX,s=t[0].pageY),this.isDragging){var o=e-this.lastTouchX,l=s-this.lastTouchY;this.enableScrollX&&(this.scrollX-=o*this.options.speedMultiplier,(this.scrollX>this.maxScrollX||this.scrollX<0)&&(this.options.bouncing?this.scrollX+=o/2*this.options.speedMultiplier:this.scrollX>this.maxScrollX?this.scrollX=this.maxScrollX:this.scrollX=0)),this.enableScrollY&&(this.scrollY-=l*this.options.speedMultiplier,(this.scrollY>this.maxScrollX||this.scrollY<0)&&(this.options.bouncing?(this.scrollY+=l/2*this.options.speedMultiplier,this.enableScrollX||null==this.refreshHeight||(!this.refreshActive&&this.scrollY<=-this.refreshHeight?(this.refreshActive=!0,this.refreshActivateCallBack&&this.refreshActivateCallBack()):this.refreshActive&&this.scrollY>-this.refreshHeight&&(this.refreshActive=!1,this.refreshDeactivateCallBack&&this.refreshDeactivateCallBack()))):this.scrollY>this.maxScrollX?this.scrollY=this.maxScrollX:this.scrollY=0)),this.positionsArray.length>60&&this.positionsArray.splice(0,30),this.positionsArray.push(this.scrollX,this.scrollY,i),this._publish(this.scrollX,this.scrollY)}else{var n=Math.abs(e-this.lastTouchX),r=Math.abs(s-this.lastTouchY);this.enableScrollX=this.options.scrollingX&&n>=0,this.enableScrollY=this.options.scrollingY&&r>=0,this.positionsArray.push(this.scrollX,this.scrollY,i);var h=this.enableScrollX||this.enableScrollY,a=n>=5||r>=5;this.isDragging=h&&a,this.isDragging&&(this._interruptedAnimation=!1)}this.lastTouchX=e,this.lastTouchY=s,this.lastTouchMoveTime=i}}},{key:"doTouchEnd",value:function(t){if(t instanceof Date&&(t=t.valueOf()),"number"!=typeof t)throw new Error("Invalid timestamp value: "+t);if(this.isTracking){if(this.isTracking=!1,this.isDragging)if(this.isDragging=!1,this.isSingleTouch&&this.options.animating&&t-this.lastTouchMoveTime<=100){for(var i=this.positionsArray.length-1,e=i,s=i;s>0&&this.positionsArray[s]>this.lastTouchMoveTime-100;s-=3)e=s;if(e!==i){var o=this.positionsArray[i]-this.positionsArray[e],l=this.scrollX-this.positionsArray[e-2],n=this.scrollY-this.positionsArray[e-1];this.decelerationVelocityX=l/o*(1e3/60),this.decelerationVelocityY=n/o*(1e3/60);var r=this.options.paging||this.options.snapping?4:1,h=Math.abs(this.decelerationVelocityX)>r,a=Math.abs(this.decelerationVelocityY)>r;h||a?this.refreshActive||this._startDeceleration(t):this.options.scrollingComplete()}else this.options.scrollingComplete()}else t-this.lastTouchMoveTime>100&&this.options.scrollingComplete();this.isDecelerating||(this.refreshActive&&this.refreshStartCallBack?(this._publish(this.scrollX,-this.refreshHeight,!0),this.refreshStartCallBack&&this.refreshStartCallBack()):((this._interruptedAnimation||this.isDragging)&&this.options.scrollingComplete(),this.scrollTo(this.scrollX,this.scrollY,!0),this.refreshActive&&(this.refreshActive=!1,this.refreshDeactivateCallBack&&this.refreshDeactivateCallBack()))),this.positionsArray.length=0}}},{key:"setDimensions",value:function(){var t=this.container.offsetWidth,i=this.container.offsetHeight,e=this.content.offsetWidth,s=this.content.offsetHeight;t===+t&&(this.containerWidth=t),i===+i&&(this.containerHeight=i),e===+e&&(this.contentWidth=e),s===+s&&(this.contentHeight=s);var o=this.maxScrollY,l=this.content.children,n=Math.max(this.contentHeight-this.containerHeight,0);this.refreshHeight=this.options.isPullRefresh?l[0].offsetHeight:0,this.loadingHeight=this.options.isReachBottom?l[l.length-1].offsetHeight:0,this.maxScrollX=Math.max(this.contentWidth-this.containerWidth,0),this.maxScrollY=n-this.refreshHeight,this.options.isReachBottom&&(o!==this.maxScrollY?this.reachBottomActive=!1:this.emit("loading",{hasMore:!1})),this.scrollTo(this.scrollX,this.scrollY,!0)}},{key:"setSnapSize",value:function(t,i){this.snapWidth=t,this.snapHeight=i}},{key:"activatePullToRefresh",value:function(t,i,e){this.refreshActivateCallBack=t,this.refreshDeactivateCallBack=i,this.refreshStartCallBack=e}},{key:"finishPullToRefresh",value:function(){this.refreshActive=!1,this.refreshDeactivateCallBack&&this.refreshDeactivateCallBack(),this.scrollTo(this.scrollX,this.scrollY,!0)}},{key:"getValues",value:function(){return{left:Math.ceil(this.scrollX),top:Math.ceil(this.scrollY)}}},{key:"scrollTo",value:function(t,i,e){this.isDecelerating&&(this.animate.stop(this.isDecelerating),this.isDecelerating=!1),this.options.scrollingX?this.options.paging?t=Math.round(t/this.containerWidth)*this.containerWidth:this.options.snapping&&(t=Math.round(t/this.snapWidth)*this.snapWidth):t=this.scrollX,this.options.scrollingY?this.options.paging?i=Math.round(i/this.containerHeight)*this.containerHeight:this.options.snapping&&(i=Math.round(i/this.snapHeight)*this.snapHeight):i=this.scrollY,t=Math.max(Math.min(this.maxScrollX,t),0),i=Math.max(Math.min(this.maxScrollY,i),0),t===this.scrollX&&i===this.scrollY&&(e=!1),this.isTracking||this._publish(t,i,e)}},{key:"scrollBy",value:function(t,i,e){var s=this.isAnimating?this.scheduledX:this.scrollX,o=this.isAnimating?this.scheduledY:this.scrollY;this.scrollTo(s+(t||0),o+(i||0),e)}},{key:"on",value:function(t,i){if(this.handles.hasOwnProperty(t)||(this.handles[t]=[]),"function"!=typeof i)throw new Error("缺少回调函数");this.handles[t].push(i)}},{key:"emit",value:function(t){for(var i=arguments.length,e=Array(i>1?i-1:0),s=1;s<i;s++)e[s-1]=arguments[s];if(!this.handles.hasOwnProperty(t))throw new Error('"'+t+'"事件未注册');this.handles[t].forEach(function(t,i,s){t.apply(null,e)})}},{key:"_publish",value:function(t,i,e){var s=this,o=this.isAnimating;if(o&&(this.animate.stop(o),this.isAnimating=!1),e&&this.options.animating){this.scheduledX=t,this.scheduledY=i;var l=this.scrollX,n=this.scrollY,r=t-l,h=i-n;this.isAnimating=this.animate.start(function(t,i,e){e&&(s.scrollX=l+r*t,s.scrollY=n+h*t,s.render&&s.render(s.scrollX,s.scrollY))},function(t){return s.isAnimating===t},function(t,i,e){i===s.isAnimating&&(s.isAnimating=!1),(s.completeDeceleration||e)&&s.options.scrollingComplete()},this.options.animationDuration,o?this.easeOutCubic:this.easeInOutCubic)}else this.scheduledX=this.scrollX=t,this.scheduledY=this.scrollY=i,this.render&&this.render(t,i);if(this.options.isReachBottom&&!this.reachBottomActive&&Number(this.scrollY.toFixed())>this.maxScrollY-this.loadingHeight&&(this.emit("loading",{hasMore:!0}),this.reachBottomActive=!0),this.options.listenScroll){var a=this.prevScrollX.toFixed()!==this.scrollX.toFixed(),c=this.prevScrollY.toFixed()!==this.scrollY.toFixed();(a||c)&&this.emit("scroll",{x:Math.floor(this.scrollX),y:Math.floor(this.scrollY)})}}},{key:"_startDeceleration",value:function(){var t=this;if(this.options.paging){var i=Math.max(Math.min(this.scrollX,this.maxScrollX),0),e=Math.max(Math.min(this.scrollY,this.maxScrollY),0);this.minDecelerationScrollX=Math.floor(i/this.containerWidth)*this.containerWidth,this.minDecelerationScrollY=Math.floor(e/this.containerHeight)*this.containerHeight,this.maxDecelerationScrollX=Math.ceil(i/this.containerWidth)*this.containerWidth,this.maxDecelerationScrollY=Math.ceil(e/this.containerHeight)*this.containerHeight}else this.minDecelerationScrollX=0,this.minDecelerationScrollY=0,this.maxDecelerationScrollX=this.maxScrollX,this.maxDecelerationScrollY=this.maxScrollY;var s=this.options.snapping?4:.001;this.isDecelerating=this.animate.start(function(i,e,s){t._stepThroughDeceleration(s)},function(){var i=Math.abs(t.decelerationVelocityX)>=s||Math.abs(t.decelerationVelocityY)>=s;return i||(t.completeDeceleration=!0),i},function(i,e,s){t.isDecelerating=!1,t.completeDeceleration&&t.options.scrollingComplete(),t.scrollTo(t.scrollX,t.scrollY,t.options.snapping)})}},{key:"_stepThroughDeceleration",value:function(t){var i=this.scrollX+this.decelerationVelocityX,e=this.scrollY+this.decelerationVelocityY;if(!this.options.bouncing){var s=Math.max(Math.min(this.maxDecelerationScrollX,i),this.minDecelerationScrollX);s!==i&&(i=s,this.decelerationVelocityX=0);var o=Math.max(Math.min(this.maxDecelerationScrollY,e),this.minDecelerationScrollY);o!==e&&(e=o,this.decelerationVelocityY=0)}if(this.prevScrollX=this.scrollX,this.prevScrollY=this.scrollY,t?this._publish(i,e):(this.scrollX=i,this.scrollY=e),!this.options.paging){this.decelerationVelocityX*=.95,this.decelerationVelocityY*=.95}if(this.options.bouncing){var l=0,n=0,r=this.options.penetrationDeceleration,h=this.options.penetrationAcceleration;i<this.minDecelerationScrollX?l=this.minDecelerationScrollX-i:i>this.maxDecelerationScrollX&&(l=this.maxDecelerationScrollX-i),e<this.minDecelerationScrollY?n=this.minDecelerationScrollY-e:e>this.maxDecelerationScrollY&&(n=this.maxDecelerationScrollY-e),0!==l&&(l*this.decelerationVelocityX<=0?this.decelerationVelocityX+=l*r:this.decelerationVelocityX=l*h),0!==n&&(n*this.decelerationVelocityY<=0?this.decelerationVelocityY+=n*r:this.decelerationVelocityY=n*h)}}}]),t}();export default Scroller;