/**
* vue-app-scroller v1.0.4
* https://github.com/JooZh/vue-app-scroller
* Released under the MIT License.
*/
var Animate=function(e){var t=Date.now||function(){return+new Date},i={},n=1,o={requestAnimationFrame:function(){var t=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame,i=!!t;if(t&&!/requestAnimationFrame\(\)\s*\{\s*\[native code\]\s*\}/i.test(t.toString())&&(i=!1),i)return function(e,i){t(e,i)};var n={},o=1,l=null,r=+new Date;return function(e,t){var i=o++;return n[i]=e,0,null===l&&(l=setInterval(function(){var e=+new Date,t=n;for(var i in n={},0,t)t.hasOwnProperty(i)&&(t[i](e),r=e);e-r>2500&&(clearInterval(l),l=null)},1e3/60)),i}}(),stop:function(e){var t=null!=i[e];return t&&(i[e]=null),t},isRunning:function(e){return null!=i[e]},start:function(e,l,r,a,s,c){var h=t(),u=h,p=0,m=0,g=n++;if(c||(c=document.body),g%20==0){var f={};for(var d in i)f[d]=!0;i=f}return i[g]=!0,o.requestAnimationFrame(function n(f){var d=!0!==f,v=t();if(!i[g]||l&&!l(g))return i[g]=null,void(r&&r(60-m/((v-h)/1e3),g,!1));if(d)for(var Y=Math.round((v-u)/(1e3/60))-1,y=0;y<Math.min(Y,4);y++)n(!0),m++;a&&(p=(v-h)/a)>1&&(p=1);var S=s?s(p):p;!1!==e(S,v,d)&&1!==p||!d?d&&(u=v,o.requestAnimationFrame(n,c)):(i[g]=null,r&&r(60-m/((v-h)/1e3),g,1===p||null==a))},c),g}};return o}(window),Render=function(e){var t=window,i=document.documentElement.style,n=void 0;t.opera&&"[object Opera]"===Object.prototype.toString.call(opera)?n="presto":"MozAppearance"in i?n="gecko":"WebkitAppearance"in i?n="webkit":"string"==typeof navigator.cpuClass&&(n="trident");var o={trident:"ms",gecko:"Moz",webkit:"Webkit",presto:"O"}[n],l=document.createElement("div"),r=o+"Perspective",a=o+"Transform";return void 0!==l.style[r]?function(t,i){e.style[a]="translate3d("+-t+"px,"+-i+"px,0)"}:void 0!==l.style[a]?function(t,i){e.style[a]="translate("+-t+"px,"+-i+"px)"}:function(t,i){e.style.marginLeft=t?-t+"px":"",e.style.marginTop=i?-i+"px":""}},_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Scroller=function(){function e(t,i){for(var n in _classCallCheck(this,e),this.NOOP=function(){console.log("s")},this.handles={scroll:[],loading:[]},this.options={listenScroll:!1,isPullRefresh:!1,isReachBottom:!1,scrollingX:!1,scrollingY:!1,animating:!0,animationDuration:250,mousewheel:!1,paging:!1,snapping:!1,snappingType:"defalut",snappingSelect:0,snappingListIndex:0,bouncing:!0,speedMultiplier:1,scrollingComplete:this.NOOP,snappingComplete:this.NOOP,penetrationDeceleration:.03,penetrationAcceleration:.08},i)this.options[n]=i[n];this._initScrollAttr(t),this._setSnapSize(this.options.snapping),this._initEventListener(this.container)}return _createClass(e,[{key:"_initEventListener",value:function(e){var t=this;t.enableScrollX=t.options.scrollingX,t.enableScrollY=t.options.scrollingY;var i=!1;e.addEventListener("touchstart",function(e){e.target.tagName.match(/input|textarea|select/i)||t.doTouchStart(e.touches,e.timeStamp)}),e.addEventListener("touchmove",function(e){e.preventDefault(),t.doTouchMove(e.touches,e.timeStamp)}),e.addEventListener("touchend",function(e){t.doTouchEnd(e.timeStamp)}),e.addEventListener("mousedown",function(e){e.target.tagName.match(/input|textarea|select/i)||(t.doTouchStart([{pageX:e.pageX,pageY:e.pageY}],e.timeStamp),i=!0)}),e.addEventListener("mousemove",function(e){i&&(t.doTouchMove([{pageX:e.pageX,pageY:e.pageY}],e.timeStamp),i=!0)}),e.addEventListener("mouseup",function(e){i&&(t.doTouchEnd(e.timeStamp),i=!1)}),t.options.mousewheel&&e.addEventListener("mousewheel",function(e){t.scrollY=t.scrollY+=e.deltaY,t.scrollY>t.maxScrollY&&(t.scrollY=t.maxScrollY),t.scrollY<0&&(t.scrollY=0),t._publish(t.scrollX,t.scrollY,!0)})}},{key:"_initScrollAttr",value:function(e){var t=this;t.content=e,t.container=e.parentNode,t.render=Render(t.content),t.animate=Animate,t.scrollDirection="",t.isTracking=!1,t.completeDeceleration=!1,t.isDragging=!1,t.isDecelerating=!1,t.isAnimating=!1,t.enableScrollX=!1,t.enableScrollY=!1,t.refreshActive=!1,t.reachBottomActive=!1,t.snappingTypeInit=!1,t.interruptedAnimation=!0,t.refreshStartCallBack=null,t.refreshDeactivateCallBack=null,t.refreshActivateCallBack=null,t.scrollX=0,t.scrollY=0,t.minScrollX=0,t.minScrollY=0,t.maxScrollX=0,t.maxScrollY=0,t.prevScrollX=0,t.prevScrollY=0,t.scheduledX=0,t.scheduledY=0,t.lastTouchX=0,t.lastTouchY=0,t.decelerationVelocityX=0,t.decelerationVelocityY=0,t.refreshHeight=0,t.loadingHeight=0,t.contentWidth=0,t.contentHeight=0,t.containerWidth=0,t.containerHeight=0,t.snapWidth=50,t.snapHeight=50,t.minDecelerationScrollX=0,t.minDecelerationScrollY=0,t.maxDecelerationScrollX=0,t.maxDecelerationScrollY=0,t.lastTouchTime=null,t.positionsArray=null}},{key:"_setSnapSize",value:function(e){"number"==typeof e?(this.snapWidth=e,this.snapHeight=e):Array.isArray(e)&&(this.snapWidth=e[0],this.snapHeight=e[1])}},{key:"_setDimensions",value:function(){var e=this,t=e.container.offsetWidth,i=e.container.offsetHeight,n=e.content.offsetWidth,o=e.content.offsetHeight;t===+t&&(e.containerWidth=t),i===+i&&(e.containerHeight=i),n===+n&&(e.contentWidth=n),o===+o&&(e.contentHeight=o);var l=e.maxScrollY,r=e.content.children,a=Math.max(e.contentHeight-e.containerHeight,0);if(e.refreshHeight=e.options.isPullRefresh?r[0].offsetHeight:0,e.loadingHeight=e.options.isReachBottom?r[r.length-1].offsetHeight:0,e.maxScrollX=Math.max(e.contentWidth-e.containerWidth,0),e.maxScrollY=a-e.refreshHeight,"select"===e.options.snappingType){var s=Math.round(e.containerHeight/e.snapHeight);if(e.minScrollY=-e.snapHeight*Math.floor(s/2),e.maxScrollY=e.minScrollY+(r[1].children.length-1)*e.snapHeight,!e.snappingTypeInit){var c=e.minScrollY+e.options.snappingSelect*e.snapHeight;e.scrollY=c,e.snappingTypeInit=!0}}e.options.isReachBottom&&(l!==e.maxScrollY?e.reachBottomActive=!1:0!=e.maxScrollY&&e.emit("loading",{hasMore:!1})),e._scrollTo(e.scrollX,e.scrollY,!0)}},{key:"_easeOutCubic",value:function(e){return Math.pow(e-1,3)+1}},{key:"_easeInOutCubic",value:function(e){return(e/=.5)<1?.5*Math.pow(e,3):.5*(Math.pow(e-2,3)+2)}},{key:"doTouchStart",value:function(e,t){this._isTouches(e),this._isTouchesTime(t),this.isTracking=!0,this.stopScroll(),this.lastTouchX=e[0].pageX,this.lastTouchY=e[0].pageY,this.lastTouchTime=t}},{key:"doTouchMove",value:function(e,t){if(this._isTouches(e),this._isTouchesTime(t),this.isTracking){var i=e[0].pageX,n=e[0].pageY;if(this._doTouchMoveDirection(i,n),this.isDragging){var o=i-this.lastTouchX,l=n-this.lastTouchY;this.enableScrollX&&this._doTouchMoveActive(o,"X"),this.enableScrollY&&this._doTouchMoveActive(l,"Y"),this.positionsArray.length>60&&this.positionsArray.splice(0,30),this.positionsArray.push(this.scrollX,this.scrollY,t),this._publish(this.scrollX,this.scrollY)}else{var r=Math.abs(i-this.lastTouchX),a=Math.abs(n-this.lastTouchY);this.isDragging=r>=5||a>=5,this.isDragging&&(this.interruptedAnimation=!1)}this.lastTouchX=i,this.lastTouchY=n,this.lastTouchTime=t}}},{key:"doTouchEnd",value:function(e){var t=this;if(t._isTouchesTime(e),t.isTracking){if(t.isTracking=!1,t.isDragging)if(t.isDragging=!1,t.options.animating&&e-t.lastTouchTime<=200)t._doTouchEndHasDeceleration()?t.refreshActive||t._startDeceleration(e):t._scrollingComplete();else e-t.lastTouchTime>200&&t._scrollingComplete();t.isDecelerating||(t.refreshActive&&t.refreshStartCallBack?(t._publish(t.scrollX,-t.refreshHeight,!0),t.refreshStartCallBack&&t.refreshStartCallBack()):((t.interruptedAnimation||t.isDragging)&&t._scrollingComplete(),t.scrollY>0||t.scrollX>0?t._scrollTo(t.scrollX,t.scrollY,!0):t._startDeceleration(),t.refreshActive&&(t.refreshActive=!1,t.refreshDeactivateCallBack&&t.refreshDeactivateCallBack()))),t.positionsArray.length=0}}},{key:"_isTouches",value:function(e){if(null==e.length)throw new Error("Invalid touch list: "+e)}},{key:"_isTouchesTime",value:function(e){if(e instanceof Date&&(e=e.valueOf()),"number"!=typeof e)throw new Error("Invalid timestamp value: "+e)}},{key:"_doTouchMoveActive",value:function(e,t){var i="scroll"+t,n="maxScroll"+t;this[i]-=e*this.options.speedMultiplier,(this[i]>this[n]||this[i]<0)&&(this.options.bouncing?(this[i]+=e/1.5*this.options.speedMultiplier,"Y"===t&&this._doTouchMovePullRefresh()):this[i]>this[n]?this[i]=this[n]:this[i]=0)}},{key:"_doTouchMovePullRefresh",value:function(){null!=this.refreshHeight&&(!this.refreshActive&&this.scrollY<=-this.refreshHeight?(this.refreshActive=!0,this.refreshActivateCallBack&&this.refreshActivateCallBack()):this.refreshActive&&this.scrollY>-this.refreshHeight&&(this.refreshActive=!1,this.refreshDeactivateCallBack&&this.refreshDeactivateCallBack()))}},{key:"_doTouchMoveDirection",value:function(e,t){var i=e-this.lastTouchX,n=t-this.lastTouchY;i>0&&Math.abs(i)>Math.abs(n)?this.scrollDirection="right":i<0&&Math.abs(i)>Math.abs(n)?this.scrollDirection="left":n>0&&Math.abs(n)>Math.abs(i)?this.scrollDirection="down":n<0&&Math.abs(n)>Math.abs(i)&&(this.scrollDirection="up")}},{key:"_doTouchEndHasDeceleration",value:function(){for(var e=!1,t=this.positionsArray.length-1,i=t,n=t;n>0&&this.positionsArray[n]>this.lastTouchTime-100;n-=3)i=n;if(i!==t){var o=this.positionsArray[t]-this.positionsArray[i],l=this.scrollX-this.positionsArray[i-2],r=this.scrollY-this.positionsArray[i-1];this.decelerationVelocityX=l/o*(1e3/60),this.decelerationVelocityY=r/o*(1e3/60);var a=this.options.paging||this.options.snapping?4:1,s=Math.abs(this.decelerationVelocityX)>a,c=Math.abs(this.decelerationVelocityY)>a;(s||c)&&(e=!0)}return e}},{key:"refresh",value:function(){this._setDimensions()}},{key:"publish",value:function(e,t,i){this._publish(e,t,i)}},{key:"scrollTo",value:function(e,t,i){this._scrollTo(e,t,i)}},{key:"scrollBy",value:function(e,t,i){this._scrollBy(e,t,i)}},{key:"getAttr",value:function(e){if(-1!==["scrollDirection","enableScrollX","enableScrollY","minScrollX","minScrollY","maxScrollX","maxScrollY"].indexOf(e))return this[e];throw new Error('can not get attr name "key" ')}},{key:"setAttr",value:function(e,t){if(-1===["enableScrollX","enableScrollY"].indexOf(e))throw new Error('can not set attr name "key" ');this[e]=t}},{key:"stopScroll",value:function(){this.isDecelerating&&(this.animate.stop(this.isDecelerating),this.isDecelerating=!1,this.interruptedAnimation=!0),this.isAnimating&&(this.animate.stop(this.isAnimating),this.isAnimating=!1,this.interruptedAnimation=!0),this.interruptedAnimation=!0,this.completeDeceleration=!1,this.positionsArray=[]}},{key:"activatePullToRefresh",value:function(e,t,i){this.refreshActivateCallBack=e,this.refreshDeactivateCallBack=t,this.refreshStartCallBack=i}},{key:"finishPullToRefresh",value:function(){this.refreshActive=!1,this.refreshDeactivateCallBack&&this.refreshDeactivateCallBack(),this._scrollTo(this.scrollX,this.scrollY,!0)}},{key:"on",value:function(e,t){if(this.handles.hasOwnProperty(e)||(this.handles[e]=[]),"function"!=typeof t)throw new Error("Missing callback function");this.handles[e].push(t)}},{key:"emit",value:function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];if(!this.handles.hasOwnProperty(e))throw new Error('"'+e+'"Event not registered');this.handles[e].forEach(function(e,t,n){e.apply(null,i)})}},{key:"_scrollTo",value:function(e,t,i){var n=this;n.isDecelerating&&(n.animate.stop(n.isDecelerating),n.isDecelerating=!1),n.options.scrollingX?n.options.paging?e=Math.round(e/n.containerWidth)*n.containerWidth:n.options.snapping&&(e=Math.round(e/n.snapWidth)*n.snapWidth):e=n.scrollX,n.options.scrollingY?n.options.paging?t=Math.round(t/n.containerHeight)*n.containerHeight:n.options.snapping&&(t=Math.round(t/n.snapHeight)*n.snapHeight):t=n.scrollY,"select"===n.options.snappingType?(e=Math.max(Math.min(n.maxScrollX,e),n.minScrollX),t=Math.max(Math.min(n.maxScrollY,t),n.minScrollY)):"default"===n.options.snappingType&&(e=Math.max(Math.min(n.maxScrollX,e),0),t=Math.max(Math.min(n.maxScrollY,t),0)),e===n.scrollX&&t===n.scrollY&&(i=!1),n.isTracking||n._publish(e,t,i)}},{key:"_scrollToElement",value:function(){}},{key:"_scrollBy",value:function(e,t,i){var n=this.isAnimating?this.scheduledX:this.scrollX,o=this.isAnimating?this.scheduledY:this.scrollY;this._scrollTo(n+(e||0),o+(t||0),i)}},{key:"_publish",value:function(e,t,i){var n=this,o=n.isAnimating;if(o&&(n.animate.stop(o),n.isAnimating=!1,n.interruptedAnimation=!0),i&&n.options.animating){n.scheduledX=e,n.scheduledY=t;var l=n.scrollX,r=n.scrollY,a=e-l,s=t-r,c=o?n._easeOutCubic:n._easeInOutCubic;n.isAnimating=n.animate.start(function(e,t,i){i&&(n.scrollX=l+a*e,n.scrollY=r+s*e,n.render&&n.render(n.scrollX,n.scrollY))},function(e){return n.isAnimating===e},function(e,t,i){t===n.isAnimating&&(n.isAnimating=!1),(n.completeDeceleration||i)&&(n._scrollingComplete(),n._snappingComplete())},n.options.animationDuration,c)}else n.scheduledX=n.scrollX=e,n.scheduledY=n.scrollY=t,n.render&&n.render(e,t);if(n.options.isReachBottom&&!n.reachBottomActive){var h=Number(n.scrollY.toFixed()),u=n.maxScrollY-n.loadingHeight;h>u&&u>0&&(n.emit("loading",{hasMore:!0}),n.reachBottomActive=!0)}if(n.options.listenScroll){var p=n.prevScrollX.toFixed()!==n.scrollX.toFixed(),m=n.prevScrollY.toFixed()!==n.scrollY.toFixed();(p||m)&&n.emit("scroll",{x:Math.floor(n.scrollX),y:Math.floor(n.scrollY)})}}},{key:"_scrollingComplete",value:function(){this.options.scrollingComplete()}},{key:"_snappingComplete",value:function(){if("select"===this.options.snappingType){var e=this._getSelectValue();this.options.snappingComplete(e)}}},{key:"_getSelectValue",value:function(){var e=Math.abs(this.minScrollY),t=(this.scrollY<0?e-Math.abs(this.scrollY):e+Math.abs(this.scrollY))/this.snapHeight;return{listIndex:this.options.snappingListIndex,selectIndex:Math.floor(t)}}},{key:"_startDeceleration",value:function(){var e=this;if(e.options.paging){var t=Math.max(Math.min(e.scrollX,e.maxScrollX),0),i=Math.max(Math.min(e.scrollY,e.maxScrollY),0);e.minDecelerationScrollX=Math.floor(t/e.containerWidth)*e.containerWidth,e.minDecelerationScrollY=Math.floor(i/e.containerHeight)*e.containerHeight,e.maxDecelerationScrollX=Math.ceil(t/e.containerWidth)*e.containerWidth,e.maxDecelerationScrollY=Math.ceil(i/e.containerHeight)*e.containerHeight}else e.minDecelerationScrollX=0,e.minDecelerationScrollY=0,e.maxDecelerationScrollX=e.maxScrollX,e.maxDecelerationScrollY=e.maxScrollY;var n=e.options.snapping?3:.02;e.isDecelerating=e.animate.start(function(t,i,n){e._stepThroughDeceleration(n)},function(){var t=Math.abs(e.decelerationVelocityX)>=n||Math.abs(e.decelerationVelocityY)>=n;return t||(e.completeDeceleration=!0),t},function(t,i,n){e.isDecelerating=!1,e.completeDeceleration&&e._scrollingComplete(),e._scrollTo(e.scrollX,e.scrollY,e.options.snapping)})}},{key:"_stepThroughDeceleration",value:function(e){var t=this,i=t.scrollX+t.decelerationVelocityX,n=t.scrollY+t.decelerationVelocityY;if(!t.options.bouncing){var o=Math.max(Math.min(t.maxDecelerationScrollX,i),t.minDecelerationScrollX);o!==i&&(i=o,t.decelerationVelocityX=0);var l=Math.max(Math.min(t.maxDecelerationScrollY,n),t.minDecelerationScrollY);l!==n&&(n=l,t.decelerationVelocityY=0)}if(t.prevScrollX=t.scrollX,t.prevScrollY=t.scrollY,e?t._publish(i,n):(t.scrollX=i,t.scrollY=n),!t.options.paging){t.decelerationVelocityX*=.975,t.decelerationVelocityY*=.975}if(t.options.bouncing){var r=0,a=0,s=t.options.penetrationDeceleration,c=t.options.penetrationAcceleration;i<t.minDecelerationScrollX?r=t.minDecelerationScrollX-i:i>t.maxDecelerationScrollX&&(r=t.maxDecelerationScrollX-i),n<t.minDecelerationScrollY?a=t.minDecelerationScrollY-n:n>t.maxDecelerationScrollY&&(a=t.maxDecelerationScrollY-n),0!==r&&(r*t.decelerationVelocityX<=0?t.decelerationVelocityX+=r*s:t.decelerationVelocityX=r*c),0!==a&&(a*t.decelerationVelocityY<=0?t.decelerationVelocityY+=a*s:t.decelerationVelocityY=a*c)}}}]),e}();export default Scroller;